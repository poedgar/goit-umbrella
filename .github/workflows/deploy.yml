name: Deploy WordPress Theme

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Deploy to Hostinger VPS
      uses: appleboy/ssh-action@v0.1.10
      with:
        host: ${{ secrets.HOSTINGER_HOST }}
        username: ${{ secrets.HOSTINGER_USERNAME }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          echo "ðŸš€ Starting WordPress theme deployment..."

          # Navigate to theme directory
          cd /home/user/htdocs/srv1155173.hstgr.cloud/wp-content/themes/goit-umbrella

          # Git: Pull latest changes
          echo "ðŸ“¥ Pulling latest code from GitHub..."
          git pull origin main

          # NPM: Install dependencies
          echo "ðŸ“¦ Installing npm packages..."
          npm install

          # Composer: Install PHP dependencies
          echo "ðŸ“¦ Installing Composer packages..."
          composer install

          # Build: Compile assets
          echo "ðŸ”¨ Building theme assets..."
          npm run build

          # WordPress: Set correct file permissions
          echo "ðŸ”’ Setting WordPress permissions..."
          find . -type d -exec chmod 755 {} \;
          find . -type f -exec chmod 644 {} \;

          # Clear caches (optional)
          echo "ðŸ§¹ Clearing caches..."
          cd /home/user/htdocs/srv1155173.hstgr.cloud
          wp cache flush 2>/dev/null || echo "WP-CLI not available, skipping cache flush"

          echo "âœ… Theme deployed successfully at $(date)"
